<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      layout:decorator="layouts/site"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <title>UMSpreadsheet</title>

    <link rel="stylesheet" th:href="@{/css/index.css}"/>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">

        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {
            /*<![CDATA[*/
            var topThreeSongs = [[${topThreeSongs}]];

            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Song');
            data.addColumn('number', 'Rating');
            data.addColumn({type: 'string', role: 'style'});
            for (i = 0; i < topThreeSongs.length; i++)
            {
                data.addRow([topThreeSongs[i].song + '\n' + topThreeSongs[i].show.date  + ' ' +
                topThreeSongs[i].show.city + ', ' + topThreeSongs[i].show.state,
                    topThreeSongs[i].trackAverageRating, 'opacity: 0.4; color: yellow']);
            }

            // Set chart options
            var options = {
                'title':'Top Songs',
                'backgroundColor':'transparent',
                'titleTextStyle': {
                    'color':'white'
                },
                'vAxis': {
                    'textStyle': {
                        'color':'white'
                    }
                },
                'hAxis': {
                    'textStyle': {
                        'color':'white'
                    }
                },
                'legend':'none'
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(
                document.getElementById('top_show_chart_div'));
            chart.draw(data, options);
        }
        /*]]>*/
    </script>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/

        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            var topThreeShows = [[${topThreeShows}]];
            console.log(topThreeShows);

            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Show');
            data.addColumn('number', 'Rating');
            data.addColumn({type: 'string', role: 'style'});
            for (i = 0; i < topThreeShows.length; i++)
            {
                data.addRow([topThreeShows[i].date + ' ' + topThreeShows[i].city + ', ' + topThreeShows[i].state,
                    topThreeShows[i].averageRating, 'opacity: 0.4; color: yellow']);
            }

            // Set chart options
            var options = {
                'title':'Top Shows',
                'backgroundColor':'transparent',
                'titleTextStyle': {
                    'color':'white'
                },
                'vAxis': {
                    'textStyle': {
                        'color':'white'
                    }
                },
                'hAxis': {
                    'textStyle': {
                        'color':'white'
                    }
                },
                'legend':'none'
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(
                document.getElementById('top_song_chart_div'));
            chart.draw(data, options);
        }
        /*]]>*/
    </script>
</head>
<body>

    <div layout:fragment="content">
        <div class="container">
            <h1 id="header-title" class="text-center">UMSpreadsheet</h1>
            <p id="header-statement">UMSpreadsheet was created to serve as a community-based resource for umphreaks.
                This resource allows participants to give a rating to every song over Umphrey's entire career in an
                effort to create a rather unique view of the music we love.  The goal is to help people find and listen
                to music that they may not have discovered on their own, plain and simple.</p>

            <br/>
            <br/>
            <br/>
            <br/>

            <div class="row">
                <div id="most-recent-show-div" class="col-md-6">
                    <div id="th-most-recent-show" th:each="show : ${lastTwoShows}" th:object="${show}">
                        <div id="most-recent-show-header">
                            <h4 id="show-title" th:text="*{#dates.format(date, 'yyyy/MM/dd') + ' ' + city + ', ' + state}">
                                2017-02-03 Detroit, MI
                            </h4>
                            <h4 id="show-rating-and-medal" class="pull-right">
                                <i class="fa fa-trophy" aria-hidden="true"></i>
                                <span th:if="*{averageRating != null}" th:text="*{#numbers.formatDecimal(averageRating, 1, 2)}">87.34</span>
                                <span th:if="*{averageRating == null}">No Rating</span>
                            </h4>
                        </div>
                        <br/>
                        <h6 th:each="set : *{sets}" th:object="${set}">
                            <strong th:text="${set.name}"></strong>:
                            <th:block th:each="track,iterStat : *{tracks}" >
                                <span th:text="${track.song}"></span>
                                <span th:if="${track.segue and !iterStat.last}"> > </span>
                                <span th:if="${!track.segue and !track.fluidSegue and !iterStat.last}">,&nbsp;</span>
                                <span th:if="${track.fluidSegue}">&nbsp;->&nbsp;</span>
                            </th:block>
                        </h6>

                        <h5 style="text-align: center">
                            <a th:href="@{/shows(showId=*{id})}" th:text="${#lists.size(show.showReviews)} + (${#lists.size(show.showReviews)} == 1? ' Review': ' Reviews')">
                            3 reviews</a>
                            &nbsp;|&nbsp;
                            <a th:href="@{/user/review(showId=*{id})}">Review</a>
                        </h5>
                        <br/>
                    </div>
                </div>
                <div id="chart-data-div" class="col-md-6">
                    <div id="top_show_chart_div"></div>
                    <br/>
                    <div class="row">
                        <div id="top_song_chart_div"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>